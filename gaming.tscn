[gd_scene load_steps=4 format=3 uid="uid://dix7kwqhcf0tw"]

[ext_resource type="PackedScene" uid="uid://ccppmwk66a86a" path="res://yellow_piece.tscn" id="2_75igm"]
[ext_resource type="PackedScene" uid="uid://d0tlkkknh3dya" path="res://red_piece.tscn" id="3_utqhf"]

[sub_resource type="GDScript" id="GDScript_bxm1x"]
script/source = "extends Node2D

@export var RedPiece: PackedScene
@export var yellow_piece: PackedScene


# Constants for grid dimensions
const ROWS = 6
const COLUMNS = 7
const EMPTY = 0
const RED = 1
const YELLOW = 2

# Variables
var grid = []
var current_player = RED


func _ready():
	initialize_grid()
	
	# Load the scenes manually (adjust the paths as needed)

	yellow_piece = load(\"res://YellowPiece.tscn\")
	print(\"Yellow Piece Loaded:\", yellow_piece)


# Initialize the grid as a 2D array
func initialize_grid():
	grid = []
	for row in range(ROWS):
		grid.append([])
		for column in range(COLUMNS):
			grid[row].append(EMPTY)

# Draw the grid as a visual reference
func _draw():
	var grid_color = Color(0.2, 0.6, 1.0)
	var cell_size = 100

	for row in range(ROWS):
		for column in range(COLUMNS):
			var rect = Rect2(Vector2(column * cell_size, row * cell_size), Vector2(cell_size, cell_size))
			draw_rect(rect, grid_color, false, 3)

# Handle input to drop a piece
func _input(event):
	if event is InputEventMouseButton and event.pressed and event.button_index == MOUSE_BUTTON_LEFT:
		var column = int(event.position.x / 100)
		if column >= 0 and column < COLUMNS:
			drop_piece(column)

# Drop a piece in the selected column
func drop_piece(column):
	for row in range(ROWS - 1, -1, -1):
		if grid[row][column] == EMPTY:
			grid[row][column] = current_player
			spawn_piece(row, column)
			if check_for_win(row, column):
				game_over()
			else:
				current_player = RED if current_player == YELLOW else YELLOW
			return

# Spawn a game piece in the scene
func spawn_piece(row, column):
	print(\"Current Player:\", current_player)
	print(\"Red Piece:\", RedPiece)
	print(\"Yellow Piece:\", yellow_piece)
	
	var piece = null
	if current_player == RED:
		piece = RedPiece.instantiate()
		print(\"Instantiating Red Piece\")
	elif current_player == YELLOW:
		piece = yellow_piece.instantiate()
		print(\"Instantiating Yellow Piece\")
	
	if piece == null:
		print(\"Error: Failed to instantiate the piece!\")
		return
	
	add_child(piece)
	piece.position = Vector2(column * 100 + 50, row * 100 + 50)


# Check for a win condition
func check_for_win(row, column):
	check_direction(row, column, 1, 0)  # Horizontal
	check_direction(row, column, 0, 1)  # Vertical
	check_direction(row, column, 1, 1)  # Diagonal (/)
	return check_direction(row, column, 1, -1)   # Diagonal (\\)

# Check a specific direction for four in a row
func check_direction(row, column, delta_row, delta_column):
	var count = 1
	count += count_in_direction(row, column, delta_row, delta_column)
	count += count_in_direction(row, column, -delta_row, -delta_column)
	return count >= 4

# Count consecutive pieces in a direction
func count_in_direction(row, column, delta_row, delta_column):
	var count = 0
	var r = row + delta_row
	var c = column + delta_column

	while r >= 0 and r < ROWS and c >= 0 and c < COLUMNS and grid[r][c] == current_player:
		count += 1
		r += delta_row
		c += delta_column

	return count

# Handle game over
func game_over():
	print(\"Player\", current_player, \"wins!\")
	get_tree().paused = true
"

[node name="Node2D" type="Node2D"]
script = SubResource("GDScript_bxm1x")

[node name="yellow_piece" parent="." instance=ExtResource("2_75igm")]

[node name="RedPiece_tscn" parent="." instance=ExtResource("3_utqhf")]
